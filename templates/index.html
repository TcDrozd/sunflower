{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Header -->
    <div class="header">
        <h1>ðŸŒ» Upward Bound</h1>
        <p>A Season in the Life of Something Tall</p>
    </div>
    
    <!-- Upload Section -->
    <div class="upload-section">
        <h2 style="margin-bottom: 1rem;">Add New Photos</h2>
        <input type="file" id="photoInput" multiple accept="image/*" style="display: none;">
        <button class="btn" onclick="document.getElementById('photoInput').click();">
            ðŸ“¸ Upload Photos
        </button>
        <p style="margin-top: 0.5rem; color: #666; font-size: 0.9rem;">
            Select one or more photos to add to your sunflower journal
        </p>
    </div>
    
    <!-- Photos Grid -->
    <div class="photo-grid">
        {% for photo in photos %}
        <div class="photo-card" onclick="showPhotoModal('{{ photo.id }}')">
            <img 
                class="lazy" 
                loading="lazy" 
                src="{{ url_for('static', filename='thumbnails/' ~ photo.thumbnail) }}"
                data-src="{{ url_for('static', filename='thumbnails/' ~ photo.preview) }}"
                alt="Sunflower photo from {{ photo.date_taken or 'Unknown date' }}">
            <div class="photo-info">
                <div class="photo-date">
                    {% if photo.date_taken %}
                        {{ photo.date_taken }}
                        {% if photo.time_taken %} at {{ photo.time_taken }}{% endif %}
                    {% else %}
                        Uploaded: {{ photo.upload_date[:10] }}
                    {% endif %}
                </div>
                <div class="photo-filename">{{ photo.original_filename }}</div>
                {% if photo.camera_info.make or photo.camera_info.model %}
                <div class="photo-camera">
                    ðŸ“· {{ photo.camera_info.make or '' }} {{ photo.camera_info.model or '' }}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        {% if not photos %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="color: #666; margin-bottom: 1rem;">No photos yet! ðŸŒ±</h3>
            <p style="color: #888;">Upload your first sunflower photo to start your growth journal.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Upload Confirmation Modal -->
<div id="uploadModal" class="modal upload-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Confirm Photo Upload</h2>
            <span class="close" onclick="hideModal('uploadModal')">&times;</span>
        </div>
        <div class="modal-body">
            <div id="filePreview"></div>
            <div class="loading" id="uploadLoading">
                <div class="spinner"></div>
                <p>Uploading photos and extracting metadata...</p>
            </div>
            <div class="success-message" id="successMessage"></div>
            <div class="error-message" id="errorMessage"></div>
            <div style="text-align: right; margin-top: 1rem;">
                <button class="btn" onclick="hideModal('uploadModal')" style="margin-right: 1rem; background: #6c757d;">Cancel</button>
                <button class="btn" onclick="confirmUpload()" id="confirmUploadBtn">Upload Photos</button>
            </div>
        </div>
    </div>
</div>

<!-- Photo Detail Modal -->
<div id="photoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="photoModalTitle">Photo Details</h2>
            <span class="close" onclick="hideModal('photoModal')">&times;</span>
        </div>
        <div class="modal-body" id="photoModalBody">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>

{% endblock %}
